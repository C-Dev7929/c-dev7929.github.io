<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --bg-default: #09090b; 
            --box-bg: rgba(9, 9, 11, 0.75);
            --text-main: #ffffff;
            --text-sub: #a1a1aa;
            --color-school: #38bdf8;
            --color-hsg: #facc15;
            --color-game: #e879f9;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-default);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        /* --- BACKGROUND LAYERS --- */
        #video-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; pointer-events: none; overflow: hidden; }
        #yt-player-container { position: absolute; top: 50%; left: 50%; width: 100vw; height: 100vh; transform: translate(-50%, -50%) scale(1.3); pointer-events: none; }
        #bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: -1; pointer-events: none; }

        /* --- UI COMPONENTS --- */
        .ui-box {
            background: var(--box-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            width: 100%; max-width: 800px; margin-bottom: 20px;
            backdrop-filter: blur(15px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.2s;
        }
        .header-box { text-align: center; margin-bottom: 30px; text-shadow: 0 4px 20px rgba(0,0,0,1); }
        #clock { font-size: 6rem; font-weight: 800; margin: 0; line-height: 1; letter-spacing: -3px; font-variant-numeric: tabular-nums; }
        #date { font-size: 1.2rem; color: #e4e4e7; margin-top: 5px; font-weight: 600; }

        .status-header { text-transform: uppercase; font-size: 0.8rem; color: var(--text-sub); letter-spacing: 1px; margin-bottom: 10px; }
        #current-activity { font-size: 2.5rem; font-weight: 700; margin: 0; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .meta-row { display: flex; justify-content: space-between; margin-top: 15px; color: #d4d4d8; font-size: 0.95rem; }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.1); width: 100%; margin-top: 20px; border-radius: 3px; overflow: hidden; }
        #progress-fill { height: 100%; background: white; width: 0%; transition: width 1s linear; }

        .grid-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 800px; margin-bottom: 30px; }
        .day-col h4 { margin: 0 0 15px 0; font-size: 0.9rem; text-transform: uppercase; color: var(--text-sub); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .list-item { display: flex; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.95rem; }
        .badge { font-size: 0.75rem; padding: 3px 6px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-right: 10px; color: #d4d4d8; min-width: 35px; text-align: center; }

        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; align-items: center; }
        .btn { background: var(--box-bg); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Inter', sans-serif; font-size: 0.9rem; transition: 0.2s; display: flex; align-items: center; gap: 5px; backdrop-filter: blur(5px); }
        .btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); }
        .btn.active { background: rgba(74, 222, 128, 0.2); border-color: #4ade80; color: #4ade80; }
        .btn-danger { border-color: #ef4444; color: #ef4444; } .btn-danger:hover { background: rgba(239, 68, 68, 0.2); }

        /* VOLUME CONTROL */
        #volume-control { display: none; align-items: center; background: var(--box-bg); padding: 5px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); gap: 10px; backdrop-filter: blur(5px); }
        input[type=range] { -webkit-appearance: none; width: 100px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; outline: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #4ade80; cursor: pointer; }

        /* TKB INPUT */
        #tkb-area { display: none; overflow-x: auto; }
        table { width: 100%; min-width: 600px; border-collapse: collapse; }
        th { text-align: left; color: var(--text-sub); padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        td { padding: 5px; }
        input[type="text"] { width: 100%; background: transparent; border: none; color: white; padding: 10px; font-family: 'Inter', sans-serif; border-bottom: 1px solid transparent; transition: 0.3s; }
        input[type="text"]:focus { outline: none; background: rgba(255,255,255,0.1); border-bottom: 1px solid var(--color-school); }
        #save-status { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: #4ade80; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 100; }

        @media (max-width: 600px) { .grid-wrapper { grid-template-columns: 1fr; } #clock { font-size: 4rem; } }
        .c-school { color: var(--color-school); } .c-hsg { color: var(--color-hsg); } .c-game { color: var(--color-game); }
    </style>
</head>
<body>

    <div id="video-background"><div id="yt-player-container"></div></div>
    <div id="bg-overlay"></div>

    <div class="header-box">
        <h1 id="clock">00:00:00</h1>
        <div id="date">ƒêang t·∫£i...</div>
    </div>

    <div class="ui-box">
        <div class="status-header">Ho·∫°t ƒë·ªông hi·ªán t·∫°i</div>
        <div id="current-activity">...</div>
        <div class="meta-row">
            <span id="sub-info">...</span>
            <span id="next-activity">Ti·∫øp theo: ...</span>
        </div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
    </div>

    <div class="grid-wrapper">
        <div class="ui-box day-col">
            <h4 id="today-label">H√¥m Nay</h4>
            <div id="today-list"></div>
        </div>
        <div class="ui-box day-col">
            <h4 id="tomorrow-label">Ng√†y Mai</h4>
            <div id="tomorrow-list"></div>
        </div>
    </div>

    <div class="controls">
        <button id="btn-notify" class="btn" onclick="toggleNotify()">üîî B·∫≠t Th√¥ng B√°o</button>
        <button class="btn" onclick="toggleSettings()">‚úèÔ∏è Nh·∫≠p TKB</button>
        <button class="btn" onclick="setYoutubeBg()">üì∫ N·ªÅn YouTube</button>
        
        <div id="volume-control">
            <span id="vol-icon">üîá</span>
            <input type="range" id="vol-slider" min="0" max="100" value="0" oninput="changeVolume(this.value)">
        </div>

        <button class="btn" onclick="document.getElementById('bg-input').click()">üñºÔ∏è N·ªÅn ·∫¢nh</button>
        <button class="btn btn-danger" onclick="hardReset()">‚ö° Reset Data</button>
        <input type="file" id="bg-input" accept="image/png, image/jpeg, image/gif" style="display: none;" onchange="handleImageUpload(event)">
    </div>

    <div id="tkb-area" class="ui-box">
        <h3 style="margin-top:0; display:flex; justify-content:space-between;">
            Nh·∫≠p Th·ªùi Kh√≥a Bi·ªÉu
            <span style="font-size:0.8rem; font-weight:400; color:#4ade80;">‚úì T·ª± ƒë·ªông l∆∞u v√†o m√°y</span>
        </h3>
        <table id="tkb-table">
            <thead><tr><th>Ti·∫øt</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr></thead>
            <tbody id="tkb-body"></tbody>
        </table>
    </div>
    <div id="save-status">ƒê√£ l∆∞u v√†o m√°y!</div>

<script>
    // --- 1. DATA CONFIG (FIXED FOR EVERYONE) ---
    // Ph·∫ßn n√†y c·ªë ƒë·ªãnh cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi d√πng
    const periods = { s1:[7,0,7,45], s2:[7,50,8,35], s3:[8,45,9,30], s4:[9,35,10,20], s5:[10,25,11,10], c1:[12,45,13,30], c2:[13,35,14,20], c3:[14,30,15,15], c4:[15,20,16,05], c5:[16,10,16,55] };
    const slots = ['s1','s2','s3','s4','s5', 'c1','c2','c3','c4','c5'];
    const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
    const slotLabels = { s1:"S1", s2:"S2", s3:"S3", s4:"S4", s5:"S5", c1:"C1", c2:"C2", c3:"C3", c4:"C4", c5:"C5" };
    const dayNames = ["Ch·ªß Nh·∫≠t", "Th·ª© Hai", "Th·ª© Ba", "Th·ª© T∆∞", "Th·ª© NƒÉm", "Th·ª© S√°u", "Th·ª© B·∫£y"];
    const colors = { school:'#38bdf8', hsg:'#facc15', game:'#e879f9', normal:'white' };
    
    // Ho·∫°t ƒë·ªông c·ªë ƒë·ªãnh (Gi·∫£ ƒë·ªãnh h·ªçc sinh n√†o c≈©ng c√≥ sinh ho·∫°t c∆° b·∫£n gi·ªëng nhau)
    const fixedActivities = [
        { name: "ƒêang ng·ªß", start: 0, end: 350, day: [1,2,3,4,5,6] }, 
        { name: "V·ªá sinh / ƒÇn s√°ng", start: 350, end: 420, day: [1,2,3,4,5,6] }, 
        { name: "ƒÇn & Ng·ªß tr∆∞a", start: 670, end: 765, day: [1,2,3,4,5,6] }, 
        { name: "Th·ªÉ thao / ƒÇn t·ªëi", start: 1015, end: 1080, day: [1,2,3,4,5,6] }, 
        { name: "Luy·ªán MOS Excel", start: 1080, end: 1140, day: [1,2,3,4,5,6], type: 'school' },
        { name: "B√†i t·∫≠p v·ªÅ nh√†", start: 1140, end: 1185, day: [1,2,3,4,5,6], type: 'school' }, 
        { name: "Leo Rank (Game)", start: 1185, end: 1305, day: [1,2,3,4,5,6], type: 'game', sub: "Gi·∫£i tr√≠ x·∫£ h∆°i" }, 
        { name: "ƒêi ng·ªß", start: 1305, end: 1440, day: [1,2,3,4,5,6] },
        { name: "ƒêang ng·ªß", start: 0, end: 480, day: [0] },
        { name: "√în Thi HSG", start: 480, end: 660, day: [0], type: 'hsg' }, 
        { name: "Gi·∫£i Tr√≠ / Game", start: 660, end: 1260, day: [0], type: 'game' }, 
        { name: "ƒêi ng·ªß", start: 1260, end: 1440, day: [0] },
    ];

    // --- 2. LOCAL DATA (PERSONAL PER MACHINE) ---
    // H√†m n√†y ch·ªâ l·∫•y d·ªØ li·ªáu t·ª´ tr√¨nh duy·ªát c·ªßa ng∆∞·ªùi d√πng
    function loadData() { 
        try { return JSON.parse(localStorage.getItem('userTKB_v8')) || createEmptyTKB(); } 
        catch { return createEmptyTKB(); } 
    }
    // T·∫°o b·∫£ng tr·ªëng cho ng∆∞·ªùi d√πng m·ªõi
    function createEmptyTKB() { 
        let tkb = {}; slots.forEach(s => { tkb[s] = {}; days.forEach(d => tkb[s][d] = ""); }); return tkb; 
    }
    let userTKB = loadData();

    // --- 3. YOUTUBE BACKGROUND & VOLUME ---
    let ytPlayer = null;
    let savedVolume = parseInt(localStorage.getItem('ytVolume')) || 0; // Volume c·ªßa ri√™ng m·ªói m√°y

    document.getElementById('vol-slider').value = savedVolume;
    updateVolIcon(savedVolume);

    function onYouTubeIframeAPIReady() {
        if (localStorage.getItem('bgType') === 'youtube') applyBackground();
    }

    function setYoutubeBg() {
        const url = prompt("Nh·∫≠p link video YouTube (L∆∞u ri√™ng tr√™n m√°y b·∫°n):");
        if (url) {
            let videoId = "";
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) videoId = match[2];
            else videoId = url;

            if (videoId.length === 11) {
                localStorage.setItem('bgType', 'youtube');
                localStorage.setItem('bgValue', videoId);
                applyBackground();
            } else { alert("Link kh√¥ng h·ª£p l·ªá!"); }
        }
    }

    function changeVolume(val) {
        savedVolume = val;
        localStorage.setItem('ytVolume', val); // L∆∞u volume v√†o m√°y
        updateVolIcon(val);
        if (ytPlayer && ytPlayer.setVolume) {
            ytPlayer.setVolume(val);
            if(val > 0) ytPlayer.unMute(); else ytPlayer.mute();
        }
    }

    function updateVolIcon(val) {
        const icon = document.getElementById('vol-icon');
        if (val == 0) icon.innerText = "üîá";
        else if (val < 50) icon.innerText = "üîâ";
        else icon.innerText = "üîä";
    }

    function handleImageUpload(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                localStorage.setItem('bgType', 'image');
                localStorage.setItem('bgValue', evt.target.result);
                applyBackground();
            }
            reader.readAsDataURL(file);
        }
    }

    // H√†m Reset d√†nh cho ng∆∞·ªùi d√πng mu·ªën x√≥a s·∫°ch d·ªØ li·ªáu
    function hardReset() {
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h·∫øt d·ªØ li·ªáu (TKB, N·ªÅn) tr√™n m√°y n√†y kh√¥ng?")) {
            localStorage.removeItem('userTKB_v8');
            localStorage.removeItem('bgType');
            localStorage.removeItem('bgValue');
            localStorage.removeItem('ytVolume');
            location.reload(); // T·∫£i l·∫°i trang ƒë·ªÉ v·ªÅ m·∫∑c ƒë·ªãnh
        }
    }

    function applyBackground() {
        const type = localStorage.getItem('bgType');
        const value = localStorage.getItem('bgValue');
        const volControl = document.getElementById('volume-control');
        
        document.body.style.backgroundImage = 'none';
        if(ytPlayer) { ytPlayer.destroy(); ytPlayer = null; }
        document.getElementById('yt-player-container').innerHTML = "";
        volControl.style.display = 'none';

        if (type === 'image' && value) {
            document.body.style.backgroundImage = `url('${value}')`;
        } 
        else if (type === 'youtube' && value) {
            volControl.style.display = 'flex';
            ytPlayer = new YT.Player('yt-player-container', {
                videoId: value,
                playerVars: {
                    'autoplay': 1, 'controls': 0, 'disablekb': 1, 'fs': 0, 'iv_load_policy': 3,
                    'rel': 0, 'showinfo': 0, 'modestbranding': 1, 'loop': 1, 'playlist': value
                },
                events: {
                    'onReady': (event) => {
                        event.target.playVideo();
                        event.target.setVolume(savedVolume);
                        if(savedVolume == 0) event.target.mute(); else event.target.unMute();
                    },
                    'onStateChange': (event) => { if (event.data === YT.PlayerState.ENDED) event.target.playVideo(); }
                }
            });
        }
    }

    // --- 4. CORE LOGIC ---
    let notifyEnabled = false;
    let lastActivityName = "";
    const alertSound = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

    function toggleNotify() {
        if (!("Notification" in window)) return alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£!");
        if (Notification.permission === "granted") {
            notifyEnabled = !notifyEnabled; updateNotifyBtn();
            if(notifyEnabled) sendSystemNotify("ƒê√£ b·∫≠t th√¥ng b√°o", "H·ªá th·ªëng s·∫Ω nh·∫Øc b·∫°n khi ƒë·ªïi ho·∫°t ƒë·ªông.");
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") { notifyEnabled = true; updateNotifyBtn(); }
            });
        }
    }
    function updateNotifyBtn() {
        const btn = document.getElementById('btn-notify');
        btn.innerHTML = notifyEnabled ? "üîî ƒê√£ B·∫≠t" : "üîï ƒê√£ T·∫Øt";
        notifyEnabled ? btn.classList.add('active') : btn.classList.remove('active');
    }
    function sendSystemNotify(title, body) {
        if (!notifyEnabled) return;
        try { alertSound.play().catch(()=>{}); new Notification(title, { body: body }); } catch (e) {}
    }
    function checkAndNotify(currentAct, type) {
        if (currentAct !== lastActivityName) {
            if (lastActivityName !== "" && type !== 'school') sendSystemNotify("Chuy·ªÉn Ho·∫°t ƒê·ªông!", currentAct);
            lastActivityName = currentAct;
        }
    }

    function autoSave(input) {
        const [slot, day] = input.id.split('-');
        userTKB[slot][day] = input.value;
        localStorage.setItem('userTKB_v8', JSON.stringify(userTKB)); // L∆∞u TKB v√†o m√°y
        updateMainLogic();
        const toast = document.getElementById('save-status');
        toast.style.opacity = '1'; setTimeout(() => toast.style.opacity = '0', 1000);
    }

    function renderEditTable() {
        const tbody = document.getElementById('tkb-body'); tbody.innerHTML = '';
        slots.forEach(slot => {
            let row = `<tr><td><span class="badge">${slotLabels[slot]}</span></td>`;
            days.forEach(day => {
                row += `<td><input type="text" id="${slot}-${day}" value="${userTKB[slot][day]}" placeholder="-" oninput="autoSave(this)"></td>`;
            });
            tbody.innerHTML += row + '</tr>';
        });
        document.querySelectorAll('#tkb-table input').forEach(inp => {
            inp.addEventListener('keydown', function(e) {
                if(e.key === 'Enter') {
                    e.preventDefault();
                    const [cSlot, cDay] = this.id.split('-');
                    const dIdx = days.indexOf(cDay), sIdx = slots.indexOf(cSlot);
                    let nDay = cDay, nSlot = cSlot;
                    if(sIdx < slots.length - 1) nSlot = slots[sIdx+1];
                    else if (dIdx < days.length - 1) { nDay = days[dIdx+1]; nSlot = slots[0]; }
                    else { nDay = days[0]; nSlot = slots[0]; }
                    document.getElementById(`${nSlot}-${nDay}`).focus();
                }
            });
        });
    }

    function renderPreview() {
        const now = new Date();
        updateList('today', now.getDay());
        updateList('tomorrow', (now.getDay()+1)%7);
    }
    function updateList(prefix, dayIdx) {
        const div = document.getElementById(`${prefix}-list`);
        document.getElementById(`${prefix}-label`).innerText = (prefix==='today'?"H√îM NAY":"NG√ÄY MAI") + ` (${dayNames[dayIdx]})`;
        div.innerHTML = '';
        if(dayIdx===0) { div.innerHTML = `<div class="list-item" style="color:#a1a1aa">üèñÔ∏è Ch·ªß Nh·∫≠t: Ngh·ªâ & √în HSG</div>`; return; }
        let has = false;
        slots.forEach(slot => {
            const subj = userTKB[slot][days[dayIdx-1]]; 
            if(subj) {
                has = true;
                const color = slot.startsWith('s') ? colors['school'] : colors['hsg'];
                div.innerHTML += `<div class="list-item"><span class="badge" style="color:${color}">${slotLabels[slot]}</span> ${subj}</div>`;
            }
        });
        if(!has) div.innerHTML = `<div class="list-item c-hsg">üî• Tr·ªëng l·ªãch: √în HSG</div>`;
    }

    function getNextActivityText(total, dayIdx) {
        const dayKey = days[dayIdx-1];
        let nextStart = Infinity; let nextActName = "ƒêi ng·ªß";
        if (dayIdx !== 0) {
            for (let s of slots) {
                const [sh, sm] = periods[s]; const st = sh * 60 + sm;
                if (st > total && st < nextStart) { nextStart = st; nextActName = userTKB[s][dayKey] ? `H·ªçc: ${userTKB[s][dayKey]}` : "Tr·ªëng ti·∫øt"; break; }
            }
        }
        for (const act of fixedActivities) {
            if (act.day.includes(dayIdx) && act.start > total && act.start < nextStart) { nextStart = act.start; nextActName = act.name; }
        }
        return nextStart === Infinity ? "Ti·∫øp theo: ƒêi ng·ªß" : `Ti·∫øp theo: ${pad(Math.floor(nextStart/60))}:${pad(nextStart%60)} - ${nextActName}`;
    }

    function updateMainLogic() {
        const now = new Date();
        const total = now.getHours()*60 + now.getMinutes();
        const dayIdx = now.getDay();
        document.getElementById('date').innerText = dayNames[dayIdx] + `, ${now.getDate()}/${now.getMonth()+1}`;
        renderPreview();
        
        let act="...", sub="", type="normal";
        const dayKey = days[dayIdx-1]; 
        if(dayIdx===0) { 
            const cnAct = fixedActivities.find(a => a.day.includes(0) && total >= a.start && total < a.end);
            if(cnAct) { act = cnAct.name; type = cnAct.type || 'normal'; sub = cnAct.sub || ""; } else { act="ƒêang ng·ªß"; } 
        } else {
            let curSlot = null;
            for(let s of slots) { const [sh,sm,eh,em]=periods[s]; if(total>=sh*60+sm && total<eh*60+em) curSlot=s; }
            if(curSlot) { 
                if(userTKB[curSlot][dayKey]) {
                    act = `H·ªçc: ${userTKB[curSlot][dayKey]}`; type="school";
                    sub = `${pad(periods[curSlot][0])}:${pad(periods[curSlot][1])} - ${pad(periods[curSlot][2])}:${pad(periods[curSlot][3])}`;
                } else { act="Tr·ªëng Ti·∫øt: √în HSG"; type="hsg"; sub = "Tranh th·ªß √¥n b√†i nh√©!"; }
            } else { 
                const fixedAct = fixedActivities.find(a => a.day.includes(dayIdx) && total >= a.start && total < a.end);
                if(fixedAct) { act = fixedAct.name; type = fixedAct.type || 'normal'; sub = fixedAct.sub || ""; } 
                else { act="Ra ch∆°i / Chuy·ªÉn ti·∫øt"; sub="Th∆∞ gi√£n m·∫Øt 5p"; } 
            }
        }
        const el = document.getElementById('current-activity');
        el.innerText = act; document.getElementById('sub-info').innerText = sub;
        el.className = ''; if(type!=='normal') el.classList.add(`c-${type}`);
        document.getElementById('next-activity').innerText = getNextActivityText(total, dayIdx);
        checkAndNotify(act, type);
    }
    
    function updateClockAndProgress() {
        const now = new Date();
        document.getElementById('clock').innerText = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
        let activityType = 'normal';
        document.getElementById('current-activity').classList.forEach(cls => { if(cls.startsWith('c-')) activityType = cls.substring(2); });
        document.getElementById('progress-fill').style.background = colors[activityType];
        document.getElementById('progress-fill').style.width = (now.getSeconds()/60*100) + "%";
    }
    function pad(n){return n<10?'0'+n:n}
    function toggleSettings() { 
        const x = document.getElementById('tkb-area'); x.style.display = x.style.display==='block'?'none':'block'; 
        if(x.style.display==='block') x.scrollIntoView({behavior:"smooth"});
    }

    renderEditTable();
    if(localStorage.getItem('bgType') !== 'youtube') applyBackground();
    updateMainLogic();
    setInterval(updateClockAndProgress, 1000); 
    setInterval(updateMainLogic, 10000);
</script>
</body>
</html>
