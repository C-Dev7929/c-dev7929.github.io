<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No title</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- C·∫§U H√åNH GIAO DI·ªÜN --- */
        :root {
            --primary: #4f46e5;       /* M√†u t√≠m xanh */
            --primary-hover: #4338ca;
            --bg-light: #f3f4f6;
            --card-light: #ffffff;
            --text-light: #1f2937;
            
            --bg-dark: #111827;
            --card-dark: #1f2937;
            --text-dark: #f9fafb;
            
            --correct: #10b981;       /* Xanh l√° */
            --wrong: #ef4444;         /* ƒê·ªè */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        #quiz-container {
            background-color: var(--card-light);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 100%;
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        /* --- N√öT DARK MODE --- */
        .theme-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 2px solid currentColor;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-light);
            transition: 0.3s;
        }
        .theme-btn:hover { transform: rotate(15deg) scale(1.1); }

        /* --- C√ÇU H·ªéI --- */
        #question-area {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* --- C√ÅC N√öT ƒê√ÅP √ÅN --- */
        .btn-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-btn {
            padding: 15px 20px;
            background-color: var(--card-light);
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            color: inherit;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .answer-btn:hover:not([disabled]) {
            border-color: var(--primary);
            background-color: #eef2ff;
            transform: translateY(-2px);
        }

        /* M√†u s·∫Øc khi ƒë√∫ng/sai */
        .answer-btn.correct {
            background-color: #d1fae5 !important;
            border-color: var(--correct) !important;
            color: #065f46 !important;
        }
        .answer-btn.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--wrong) !important;
            color: #991b1b !important;
        }

        /* --- GI·∫¢I TH√çCH --- */
        #explanation-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff7ed;
            border-left: 4px solid #f97316;
            border-radius: 6px;
            color: #9a3412;
            display: none;
            line-height: 1.5;
            animation: fadeIn 0.5s;
        }

        /* --- N√öT NEXT --- */
        #next-btn {
            display: none;
            width: 100%;
            padding: 14px;
            margin-top: 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
            transition: 0.3s;
        }
        #next-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        /* --- K·∫æT QU·∫¢ --- */
        #result-area {
            text-align: center;
            display: none;
        }

        /* --- DARK MODE --- */
        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }
        body.dark-mode #quiz-container {
            background-color: var(--card-dark);
        }
        body.dark-mode .theme-btn { color: var(--text-dark); }
        body.dark-mode .answer-btn {
            background-color: #374151;
            border-color: #4b5563;
        }
        body.dark-mode .answer-btn:hover:not([disabled]) {
            background-color: #4b5563;
            border-color: var(--primary);
        }
        body.dark-mode #explanation-area {
            background-color: #431407;
            color: #ffedd5;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <button id="theme-toggle" class="theme-btn">üåô</button>

    <div id="quiz-container">
        <h1>üìú L·ªãch S·ª≠ & X√£ H·ªôi</h1>
        
        <div id="question-area">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        
        <div id="answer-buttons" class="btn-grid"></div>
        
        <div id="explanation-area">
            <strong>üí° Gi·∫£i th√≠ch:</strong> <span id="explanation-text"></span>
        </div>

        <button id="next-btn">C√¢u ti·∫øp theo ‚ûú</button>
        
        <div id="result-area">
            <h2>üéâ Ho√†n Th√†nh!</h2>
            <p>B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng:</p>
            <p id="final-score" style="font-size: 2rem; font-weight: bold; color: var(--primary);">0/0</p>
            <button class="answer-btn" style="text-align: center; margin-top: 15px;" onclick="location.reload()">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <script>
        // --- 1. DARK MODE ---
        const toggleBtn = document.getElementById('theme-toggle');
        const body = document.body;
        toggleBtn.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            toggleBtn.textContent = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        });

        // --- 2. BI·∫æN TO√ÄN C·ª§C ---
        const questionArea = document.getElementById('question-area');
        const answerButtons = document.getElementById('answer-buttons');
        const nextButton = document.getElementById('next-btn');
        const explanationArea = document.getElementById('explanation-area');
        const explanationText = document.getElementById('explanation-text');
        const resultArea = document.getElementById('result-area');
        const finalScore = document.getElementById('final-score');
        const titleElement = document.querySelector('h1');

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        // --- 3. T·∫¢I D·ªÆ LI·ªÜU ---
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const fileName = urlParams.get('file');

            if (!fileName) {
                console.log("Kh√¥ng t√¨m th·∫•y tham s·ªë file, th·ª≠ t·∫£i m·∫∑c ƒë·ªãnh text.json");
                fetchData('text.json'); 
            } else {
                fetchData(fileName);
            }
        });

        async function fetchData(url) {
            try {
                questionArea.innerText = "ƒêang t·∫£i c√¢u h·ªèi...";
                const response = await fetch(url);
                if (!response.ok) throw new Error("Kh√¥ng th·ªÉ ƒë·ªçc file data.");
                
                const data = await response.json();
                
                if (Array.isArray(data) && data.length > 0) {
                    questions = data;
                    startQuiz();
                } else {
                    questionArea.innerText = "File d·ªØ li·ªáu r·ªóng!";
                }
            } catch (error) {
                console.error(error);
                questionArea.innerHTML = `<span style="color:var(--wrong)">L·ªói: ${error.message}<br>H√£y ch·∫°y tr√™n Localhost (Live Server)!</span>`;
            }
        }

        // --- 4. LOGIC QUIZ ---
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            nextButton.style.display = 'none';
            resultArea.style.display = 'none';
            titleElement.innerText = "Tr·∫Øc Nghi·ªám Ki·∫øn Th·ª©c"; 
            showQuestion();
        }

        function showQuestion() {
            resetState();
            let currentQ = questions[currentQuestionIndex];
            
            // Hi·ªÉn th·ªã c√¢u h·ªèi
            questionArea.innerText = currentQ.cauhoi;

            // X·ª≠ l√Ω ƒë√°p √°n (T√°ch chu·ªói b·∫±ng d·∫•u |)
            if (currentQ.cac_dap_an) {
                const answers = currentQ.cac_dap_an.split('|'); 
                
                answers.forEach((ansText, index) => {
                    const button = document.createElement('button');
                    button.innerText = ansText;
                    button.classList.add('answer-btn');
                    
                    // X√°c ƒë·ªãnh ƒë√°p √°n ƒë√∫ng
                    const mapChar = ['A', 'B', 'C', 'D', 'E', 'F'];
                    const correctChar = currentQ.dap_an_dung.trim().toUpperCase();
                    
                    if (mapChar[index] === correctChar) {
                        button.dataset.correct = "true";
                    }
                    
                    button.addEventListener('click', selectAnswer);
                    answerButtons.appendChild(button);
                });
            }
        }

        function resetState() {
            nextButton.style.display = 'none';
            explanationArea.style.display = 'none';
            while (answerButtons.firstChild) {
                answerButtons.removeChild(answerButtons.firstChild);
            }
        }

        function selectAnswer(e) {
            const selectedBtn = e.target;
            const isCorrect = selectedBtn.dataset.correct === "true";
            
            if (isCorrect) {
                selectedBtn.classList.add('correct');
                score++;
            } else {
                selectedBtn.classList.add('wrong');
            }

            // Hi·ªán ƒë√°p √°n ƒë√∫ng v√† kh√≥a t·∫•t c·∫£ n√∫t
            Array.from(answerButtons.children).forEach(button => {
                if (button.dataset.correct === "true") {
                    button.classList.add('correct');
                }
                button.disabled = true;
                button.style.cursor = "default";
            });

            // --- X·ª¨ L√ù GI·∫¢I TH√çCH & T·ª∞ ƒê·ªòNG CU·ªòN ---
            const currentQ = questions[currentQuestionIndex];
            if (currentQ.giaithich) {
                // Format in ƒë·∫≠m
                let formattedExplanation = currentQ.giaithich.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                explanationText.innerHTML = formattedExplanation;
                explanationArea.style.display = 'block';

                // !!! M·ªöI: L·ªánh t·ª± ƒë·ªông cu·ªôn xu·ªëng ph·∫ßn gi·∫£i th√≠ch !!!
                // behavior: 'smooth' -> cu·ªôn m∆∞·ª£t
                // block: 'center' -> ƒë∆∞a ph·∫ßn gi·∫£i th√≠ch v√†o gi·ªØa m√†n h√¨nh
                explanationArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            nextButton.style.display = 'block';
        }

        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showScore();
            }
        });

        function showScore() {
            resetState();
            questionArea.innerText = "ƒê√£ h·∫øt c√¢u h·ªèi!";
            titleElement.innerText = "K·∫øt Qu·∫£";
            resultArea.style.display = 'block';
            finalScore.innerText = `${score} / ${questions.length}`;
        }
    </script>
</body>
</html>
